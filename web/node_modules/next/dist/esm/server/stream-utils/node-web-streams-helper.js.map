{"version":3,"sources":["../../../src/server/stream-utils/node-web-streams-helper.ts"],"names":["nonNullable","getTracer","AppRenderSpan","decodeText","encodeText","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","streamToBufferedResult","renderResult","renderChunks","textDecoder","TextDecoder","writable","write","chunk","push","end","on","off","pipe","join","cloneTransformStream","source","sourceReader","readable","getReader","clone","TransformStream","start","controller","done","value","read","enqueue","transform","chainStreams","streams","promise","Promise","resolve","i","length","then","pipeTo","preventClose","streamFromString","str","ReadableStream","close","streamToString","stream","reader","bufferedString","createBufferedTransformStream","bufferedBytes","Uint8Array","pendingFlush","flushBuffer","newBufferedBytes","byteLength","set","flush","createInsertedHTMLStream","getServerInsertedHTML","insertedHTMLChunk","renderToInitialStream","ReactDOMServer","element","streamOptions","trace","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","createDeferredSuffixStream","suffix","suffixFlushed","suffixFlushTask","res","createInlineDataStream","dataStream","dataStreamFinished","dataStreamReader","err","error","createMoveSuffixStream","foundSuffix","endsWith","contentWithoutSuffix","createRootLayoutValidatorStream","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","JSON","stringify","tree","continueFromInitialStream","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","reduce","pipeThrough"],"mappings":"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"}