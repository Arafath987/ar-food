{"version":3,"sources":["../../../src/server/app-render/action-handler.ts"],"names":["handleAction","nodeToWebReadableStream","nodeReadable","process","env","NEXT_RUNTIME","Readable","require","toWeb","ReadableStream","start","controller","on","chunk","enqueue","close","error","Error","formDataFromSearchQueryString","query","searchParams","URLSearchParams","formData","FormData","key","value","append","nodeHeadersToRecord","headers","record","Object","entries","undefined","Array","isArray","join","getForwardedHeaders","req","res","requestHeaders","requestCookies","responseHeaders","getHeaders","rawSetCookies","setCookies","map","setCookie","cookie","split","mergedHeaders","filterReqHeaders","actionsForbiddenHeaders","mergedCookies","concat","Headers","addRevalidationHeader","staticGenerationStore","requestStore","Promise","all","pendingRevalidates","isTagRevalidated","revalidatedTags","length","isCookieRevalidated","getModifiedCookieValues","mutableCookies","setHeader","JSON","stringify","createRedirectRenderResult","redirectUrl","startsWith","forwardedHeaders","set","RSC","host","proto","incrementalCache","requestProtocol","fetchUrl","URL","NEXT_CACHE_REVALIDATED_TAGS_HEADER","NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER","prerenderManifest","preview","previewModeId","delete","headResponse","fetch","method","next","internal","get","RSC_CONTENT_TYPE_HEADER","response","includes","FlightRenderResult","body","err","console","RenderResult","ComponentMod","page","serverActionsManifest","generateFlight","serverActionsBodySizeLimit","actionId","ACTION","toLowerCase","contentType","isURLEncodedAction","isMultipartAction","isFetchAction","bound","workerName","serverModuleMap","Proxy","_","id","workers","name","chunks","actionAsyncStorage","actionResult","run","isAction","decodeReply","decodeAction","webRequest","request","action","actionData","reader","getReader","done","read","TextDecoder","decode","decodeReplyFromBusboy","busboy","bb","pipe","UndiciRequest","Request","fakeRequest","duplex","parseBody","e","statusCode","message","actionModId","actionHandler","__next_app__","returnVal","apply","resolve","skipFlight","pathWasRevalidated","isRedirectError","getURLFromRedirectError","appendMutableCookies","from","values","isNotFoundError","promise","reject","asNotFound"],"mappings":"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"}