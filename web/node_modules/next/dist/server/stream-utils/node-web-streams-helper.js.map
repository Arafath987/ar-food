{"version":3,"sources":["../../../src/server/stream-utils/node-web-streams-helper.ts"],"names":["streamToBufferedResult","cloneTransformStream","chainStreams","streamFromString","streamToString","createBufferedTransformStream","createInsertedHTMLStream","renderToInitialStream","createInlineDataStream","createRootLayoutValidatorStream","continueFromInitialStream","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","renderResult","renderChunks","textDecoder","TextDecoder","writable","write","chunk","push","decodeText","end","on","off","pipe","join","source","sourceReader","readable","getReader","clone","TransformStream","start","controller","done","value","read","enqueue","transform","streams","promise","Promise","resolve","i","length","then","pipeTo","preventClose","str","ReadableStream","encodeText","close","stream","reader","bufferedString","bufferedBytes","Uint8Array","pendingFlush","flushBuffer","newBufferedBytes","byteLength","set","flush","getServerInsertedHTML","insertedHTMLChunk","ReactDOMServer","element","streamOptions","getTracer","trace","AppRenderSpan","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","createDeferredSuffixStream","suffix","suffixFlushed","suffixFlushTask","res","dataStream","dataStreamFinished","dataStreamReader","err","error","createMoveSuffixStream","foundSuffix","endsWith","contentWithoutSuffix","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","nonNullable","JSON","stringify","tree","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","reduce","pipeThrough"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;IAeaA,sBAAsB;eAAtBA;;IAoBGC,oBAAoB;eAApBA;;IAmBAC,YAAY;eAAZA;;IAeAC,gBAAgB;eAAhBA;;IASMC,cAAc;eAAdA;;IAmBNC,6BAA6B;eAA7BA;;IAuCAC,wBAAwB;eAAxBA;;IAYAC,qBAAqB;eAArBA;;IAkGAC,sBAAsB;eAAtBA;;IAoFAC,+BAA+B;eAA/BA;;IA0CMC,yBAAyB;eAAzBA;;;6BAjXM;wBACF;2BACI;8BACS;AAEvC,MAAMC,YACJC,QAAQC,GAAG,CAACC,YAAY,KAAK,SAASC,WAAWC,UAAU,GAAGC;AAMzD,MAAMjB,yBAAyB,OACpCkB;IAEA,MAAMC,eAAyB,EAAE;IACjC,MAAMC,cAAc,IAAIC;IAExB,MAAMC,WAAW;QACfC,OAAMC,KAAU;YACdL,aAAaM,IAAI,CAACC,IAAAA,wBAAU,EAACF,OAAOJ;QACtC;QACAO,QAAO;QAEP,wCAAwC;QACxCC,OAAM;QACNC,QAAO;IACT;IACA,MAAMX,aAAaY,IAAI,CAACR;IACxB,OAAOH,aAAaY,IAAI,CAAC;AAC3B;AAEO,SAAS9B,qBAAqB+B,MAAuB;IAC1D,MAAMC,eAAeD,OAAOE,QAAQ,CAACC,SAAS;IAC9C,MAAMC,QAAQ,IAAIC,gBAAgB;QAChC,MAAMC,OAAMC,UAAU;YACpB,MAAO,KAAM;gBACX,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAMR,aAAaS,IAAI;gBAC/C,IAAIF,MAAM;oBACR;gBACF;gBACAD,WAAWI,OAAO,CAACF;YACrB;QACF;QACA,wBAAwB;QACxBG,cAAa;IACf;IAEA,OAAOR;AACT;AAEO,SAASlC,aACd2C,OAA4B;IAE5B,MAAM,EAAEX,QAAQ,EAAEZ,QAAQ,EAAE,GAAG,IAAIe;IAEnC,IAAIS,UAAUC,QAAQC,OAAO;IAC7B,IAAK,IAAIC,IAAI,GAAGA,IAAIJ,QAAQK,MAAM,EAAE,EAAED,EAAG;QACvCH,UAAUA,QAAQK,IAAI,CAAC,IACrBN,OAAO,CAACI,EAAE,CAACG,MAAM,CAAC9B,UAAU;gBAAE+B,cAAcJ,IAAI,IAAIJ,QAAQK,MAAM;YAAC;IAEvE;IAEA,OAAOhB;AACT;AAEO,SAAS/B,iBAAiBmD,GAAW;IAC1C,OAAO,IAAIC,eAAe;QACxBjB,OAAMC,UAAU;YACdA,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAACF;YAC9Bf,WAAWkB,KAAK;QAClB;IACF;AACF;AAEO,eAAerD,eACpBsD,MAAkC;IAElC,MAAMC,SAASD,OAAOvB,SAAS;IAC/B,MAAMf,cAAc,IAAIC;IAExB,IAAIuC,iBAAiB;IAErB,MAAO,KAAM;QACX,MAAM,EAAEpB,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAMkB,OAAOjB,IAAI;QAEzC,IAAIF,MAAM;YACR,OAAOoB;QACT;QAEAA,kBAAkBlC,IAAAA,wBAAU,EAACe,OAAOrB;IACtC;AACF;AAEO,SAASf;IAId,IAAIwD,gBAA4B,IAAIC;IACpC,IAAIC,eAAqC;IAEzC,MAAMC,cAAc,CAACzB;QACnB,IAAI,CAACwB,cAAc;YACjBA,eAAe,IAAIhB,QAAQ,CAACC;gBAC1BrC,UAAU;oBACR4B,WAAWI,OAAO,CAACkB;oBACnBA,gBAAgB,IAAIC;oBACpBC,eAAe;oBACff;gBACF;YACF;QACF;IACF;IAEA,OAAO,IAAIX,gBAAgB;QACzBO,WAAUpB,KAAK,EAAEe,UAAU;YACzB,MAAM0B,mBAAmB,IAAIH,WAC3BD,cAAcX,MAAM,GAAG1B,MAAM0C,UAAU;YAEzCD,iBAAiBE,GAAG,CAACN;YACrBI,iBAAiBE,GAAG,CAAC3C,OAAOqC,cAAcX,MAAM;YAChDW,gBAAgBI;YAChBD,YAAYzB;QACd;QAEA6B;YACE,IAAIL,cAAc;gBAChB,OAAOA;YACT;QACF;IACF;AACF;AAEO,SAASzD,yBACd+D,qBAA4C;IAE5C,OAAO,IAAIhC,gBAAgB;QACzB,MAAMO,WAAUpB,KAAK,EAAEe,UAAU;YAC/B,MAAM+B,oBAAoBd,IAAAA,wBAAU,EAAC,MAAMa;YAC3C9B,WAAWI,OAAO,CAAC2B;YACnB/B,WAAWI,OAAO,CAACnB;QACrB;IACF;AACF;AAEO,SAASjB,sBAAsB,EACpCgE,cAAc,EACdC,OAAO,EACPC,aAAa,EAKd;IACC,OAAOC,IAAAA,iBAAS,IAAGC,KAAK,CAACC,wBAAa,CAACC,sBAAsB,EAAE,UAC7DN,eAAeM,sBAAsB,CAACL,SAASC;AAEnD;AAEA,SAASK,mCACPC,MAA6B;IAE7B,IAAIC,WAAW;IACf,IAAIC,WAAW;IACf,MAAM7D,cAAc,IAAIC;IAExB,OAAO,IAAIgB,gBAAgB;QACzB,MAAMO,WAAUpB,KAAK,EAAEe,UAAU;YAC/B,4DAA4D;YAC5D,IAAI0C,UAAU;gBACZ1C,WAAWI,OAAO,CAACnB;gBACnB;YACF;YAEA,MAAM0D,YAAY,MAAMH;YACxB,IAAIC,UAAU;gBACZzC,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAAC0B;gBAC9B3C,WAAWI,OAAO,CAACnB;gBACnByD,WAAW;YACb,OAAO;gBACL,MAAME,UAAUzD,IAAAA,wBAAU,EAACF,OAAOJ;gBAClC,MAAMgE,QAAQD,QAAQE,OAAO,CAAC;gBAC9B,IAAID,UAAU,CAAC,GAAG;oBAChB,MAAME,sBACJH,QAAQI,KAAK,CAAC,GAAGH,SAASF,YAAYC,QAAQI,KAAK,CAACH;oBACtD7C,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAAC8B;oBAC9BL,WAAW;oBACXD,WAAW;gBACb;YACF;YAEA,IAAI,CAACA,UAAU;gBACbzC,WAAWI,OAAO,CAACnB;YACrB,OAAO;gBACLb,UAAU;oBACRsE,WAAW;gBACb;YACF;QACF;QACA,MAAMb,OAAM7B,UAAU;YACpB,gEAAgE;YAChE,MAAM2C,YAAY,MAAMH;YACxB,IAAIG,WAAW;gBACb3C,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAAC0B;YAChC;QACF;IACF;AACF;AAEA,2DAA2D;AAC3D,gDAAgD;AAChD,SAASM,2BACPC,MAAc;IAEd,IAAIC,gBAAgB;IACpB,IAAIC,kBAAwC;IAE5C,OAAO,IAAItD,gBAAgB;QACzBO,WAAUpB,KAAK,EAAEe,UAAU;YACzBA,WAAWI,OAAO,CAACnB;YACnB,IAAI,CAACkE,iBAAiBD,OAAOvC,MAAM,EAAE;gBACnCwC,gBAAgB;gBAChBC,kBAAkB,IAAI5C,QAAQ,CAAC6C;oBAC7B,wBAAwB;oBACxB,mEAAmE;oBACnE,iEAAiE;oBACjEjF,UAAU;wBACR4B,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAACiC;wBAC9BG;oBACF;gBACF;YACF;QACF;QACAxB,OAAM7B,UAAU;YACd,IAAIoD,iBAAiB,OAAOA;YAC5B,IAAI,CAACD,iBAAiBD,OAAOvC,MAAM,EAAE;gBACnCwC,gBAAgB;gBAChBnD,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAACiC;YAChC;QACF;IACF;AACF;AAEO,SAASjF,uBACdqF,UAAsC;IAEtC,IAAIC,qBAA2C;IAC/C,OAAO,IAAIzD,gBAAgB;QACzBO,WAAUpB,KAAK,EAAEe,UAAU;YACzBA,WAAWI,OAAO,CAACnB;YAEnB,IAAI,CAACsE,oBAAoB;gBACvB,MAAMC,mBAAmBF,WAAW1D,SAAS;gBAE7C,wBAAwB;gBACxB,gEAAgE;gBAChE,qEAAqE;gBACrE,uEAAuE;gBACvE,8DAA8D;gBAC9D,aAAa;gBACb2D,qBAAqB,IAAI/C,QAAQ,CAAC6C,MAChC,uEAAuE;oBACvE,mEAAmE;oBACnE,wCAAwC;oBACxC,uEAAuE;oBACvE,mEAAmE;oBACnE,WAAW;oBACX5E,WAAW;wBACT,IAAI;4BACF,MAAO,KAAM;gCACX,MAAM,EAAEwB,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAMsD,iBAAiBrD,IAAI;gCACnD,IAAIF,MAAM;oCACR,OAAOoD;gCACT;gCACArD,WAAWI,OAAO,CAACF;4BACrB;wBACF,EAAE,OAAOuD,KAAK;4BACZzD,WAAW0D,KAAK,CAACD;wBACnB;wBACAJ;oBACF,GAAG;YAEP;QACF;QACAxB;YACE,IAAI0B,oBAAoB;gBACtB,OAAOA;YACT;QACF;IACF;AACF;AAEA;;;;CAIC,GACD,SAASI,uBACPT,MAAc;IAEd,IAAIU,cAAc;IAClB,MAAM/E,cAAc,IAAIC;IAExB,8DAA8D;IAC9D,OAAO,IAAIgB,gBAAgB;QACzBO,WAAUpB,KAAK,EAAEe,UAAU;YACzB,IAAI,CAACkD,UAAUU,aAAa;gBAC1B,OAAO5D,WAAWI,OAAO,CAACnB;YAC5B;YAEA,MAAM2D,UAAUzD,IAAAA,wBAAU,EAACF,OAAOJ;YAClC,IAAI+D,QAAQiB,QAAQ,CAACX,SAAS;gBAC5BU,cAAc;gBACd,MAAME,uBAAuBlB,QAAQI,KAAK,CAAC,GAAG,CAACE,OAAOvC,MAAM;gBAC5DX,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAAC6C;YAChC,OAAO;gBACL9D,WAAWI,OAAO,CAACnB;YACrB;QACF;QACA4C,OAAM7B,UAAU;YACd,IAAIkD,QAAQ;gBACVlD,WAAWI,OAAO,CAACa,IAAAA,wBAAU,EAACiC;YAChC;QACF;IACF;AACF;AAEO,SAAShF,gCACd6F,cAAc,EAAE,EAChBC,OAAgC;IAEhC,IAAIC,YAAY;IAChB,IAAIC,YAAY;IAChB,MAAMrF,cAAc,IAAIC;IAExB,OAAO,IAAIgB,gBAAgB;QACzB,MAAMO,WAAUpB,KAAK,EAAEe,UAAU;YAC/B,IAAI,CAACiE,aAAa,CAACC,WAAW;gBAC5B,MAAMtB,UAAUzD,IAAAA,wBAAU,EAACF,OAAOJ;gBAClC,IAAI,CAACoF,aAAarB,QAAQuB,QAAQ,CAAC,UAAU;oBAC3CF,YAAY;gBACd;gBACA,IAAI,CAACC,aAAatB,QAAQuB,QAAQ,CAAC,UAAU;oBAC3CD,YAAY;gBACd;YACF;YACAlE,WAAWI,OAAO,CAACnB;QACrB;QACA4C,OAAM7B,UAAU;YACd,uEAAuE;YACvE,cAAc;YACd,IAAI,CAACiE,aAAa,CAACC,WAAW;gBAC5B,MAAME,cAAc;oBAClBH,YAAY,OAAO;oBACnBC,YAAY,OAAO;iBACpB,CAACG,MAAM,CAACC,wBAAW;gBAEpBtE,WAAWI,OAAO,CAChBa,IAAAA,wBAAU,EACR,CAAC,mDAAmD,EAAEsD,KAAKC,SAAS,CAClE;oBAAEJ;oBAAaL,aAAaA,eAAe;oBAAIU,MAAMT;gBAAU,GAC/D,SAAS,CAAC;YAGlB;QACF;IACF;AACF;AAEO,eAAe7F,0BACpBuG,YAAiC,EACjC,EACExB,MAAM,EACNI,UAAU,EACVqB,kBAAkB,EAClB7C,qBAAqB,EACrB8C,wBAAwB,EACxBC,kBAAkB,EAYnB;IAED,MAAMC,WAAW;IAEjB,6EAA6E;IAC7E,MAAMC,iBAAiB7B,SAASA,OAAO8B,KAAK,CAACF,SAAS,CAAC,EAAE,GAAG;IAE5D,IAAIH,oBAAoB;QACtB,MAAMD,aAAaO,QAAQ;IAC7B;IAEA,MAAMC,aAA6D;QACjE,qDAAqD;QACrDpH;QAEA,gCAAgC;QAChCgE,yBAAyB,CAAC8C,2BACtB7G,yBAAyB+D,yBACzB;QAEJ,wBAAwB;QACxBiD,kBAAkB,OAAO9B,2BAA2B8B,kBAAkB;QAEtE,gCAAgC;QAChCzB,aAAarF,uBAAuBqF,cAAc;QAElD,kDAAkD;QAClDK,uBAAuBmB;QAEvB,0BAA0B;QAC1B,qFAAqF;QACrF,+EAA+E;QAC/EhD,yBAAyB8C,2BACrBrC,mCAAmCT,yBACnC;QAEJ+C,qBACI3G,gCACE2G,mBAAmBd,WAAW,EAC9Bc,mBAAmBb,OAAO,IAE5B;KACL,CAACK,MAAM,CAACC,wBAAW;IAEpB,OAAOY,WAAWC,MAAM,CACtB,CAACxF,UAAUU,YAAcV,SAASyF,WAAW,CAAC/E,YAC9CqE;AAEJ"}